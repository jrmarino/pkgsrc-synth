$NetBSD: patch-CVE-2018-1071,v 1.1 2018/03/30 20:56:42 spz Exp $

patch for CVE-2018-1071 from
https://sourceforge.net/p/zsh/code/ci/679b71ec4d852037fe5f73d35bf557b0f406c8d4/

--- Src/exec.c.orig	2017-08-27 19:28:43.000000000 +0000
+++ Src/exec.c	2018-03-30 20:10:46.000000000 +0000
@@ -920,7 +920,7 @@
     for (; *pp; pp++)
 	if (**pp == '/') {
 	    s = buf;
-	    strucpy(&s, *pp);
+	    struncpy(&s, *pp, PATH_MAX);
 	    *s++ = '/';
 	    if ((s - buf) + strlen(arg0) >= PATH_MAX)
 		continue;
--- Src/utils.c.orig	2017-08-08 18:02:32.000000000 +0000
+++ Src/utils.c	2018-03-30 20:13:16.000000000 +0000
@@ -2283,10 +2283,10 @@
 {
     char *u = *s;
 
-    while (n--)
-	*u++ = *t++;
+    while (n-- && (*u++ = *t++));
     *s = u;
-    *u = '\0';
+    if (n > 0) /* just one null-byte will do, unlike strncpy(3) */
+        *u = '\0';
 }
 
 /* Return the number of elements in an array of pointers. *
