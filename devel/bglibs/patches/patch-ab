$NetBSD: patch-ab,v 1.7 2016/12/31 15:13:43 schmonz Exp $

--- Makefile.orig	2009-02-19 17:11:51.000000000 +0000
+++ Makefile
@@ -69,7 +69,7 @@ adt/hashb.lo adt/hashb.o: ltcompile adt/
 adt/hashs.lo adt/hashs.o: ltcompile adt/hashs.c adt/common.h
 	./ltcompile adt/hashs.c
 
-all: dotlibs sysdeps.h libraries bg-installer cli-generate selftests
+all: dotlibs sysdeps.h libraries bg-installer cli-generate
 
 base64/asc2bin.lo base64/asc2bin.o: ltcompile base64/asc2bin.c base64/base64.h str/str.h
 	./ltcompile base64/asc2bin.c
@@ -210,7 +210,7 @@ crypt.lib: compile load
 	@echo 'main() { ; }' >trylib-lcrypt.c
 	@{ ./compile trylib-lcrypt.c && ./load trylib-lcrypt -lcrypt; } >/dev/null 2>&1 \
 	  && { echo -lcrypt >crypt.lib; echo yes; } \
-	  || { echo -n >crypt.lib; echo no; }
+	  || { : >crypt.lib; echo no; }
 	@rm -f trylib-lcrypt.c trylib-lcrypt.o trylib-lcrypt
 
 crypto/hmac-md5.lo crypto/hmac-md5.o: ltcompile crypto/hmac-md5.c sysdeps.h crypto/hmac.h crypto/md5.h str/str.h
@@ -290,7 +290,7 @@ dl.lib: compile load
 	@echo 'main() { ; }' >trylib-ldl.c
 	@{ ./compile trylib-ldl.c && ./load trylib-ldl -ldl; } >/dev/null 2>&1 \
 	  && { echo -ldl >dl.lib; echo yes; } \
-	  || { echo -n >dl.lib; echo no; }
+	  || { : >dl.lib; echo no; }
 	@rm -f trylib-ldl.c trylib-ldl.o trylib-ldl
 
 dotlibs: crypt.lib dl.lib m.lib net.lib rt.lib s.lib shadow.lib socket.lib
@@ -624,7 +624,7 @@ m.lib: compile load
 	@echo 'main() { ; }' >trylib-lm.c
 	@{ ./compile trylib-lm.c && ./load trylib-lm -lm; } >/dev/null 2>&1 \
 	  && { echo -lm >m.lib; echo yes; } \
-	  || { echo -n >m.lib; echo no; }
+	  || { : >m.lib; echo no; }
 	@rm -f trylib-lm.c trylib-lm.o trylib-lm
 
 makeshlib: conf-ld conf-lib LIBVERSION Makefile
@@ -632,7 +632,7 @@ makeshlib: conf-ld conf-lib LIBVERSION M
 	  echo '#!/bin/sh'; \
 	  echo 'lib="$$1"; shift';\
 	  echo 'rm -f "$$lib"';\
-	  echo libtool --mode=link --silent $$tag `head -n 1 conf-ld` '-o "$$lib" -rpath' `head -n 1 conf-lib` -version-info `head -n 1 LIBVERSION` '$${1+"$$@"}';\
+	  echo libtool --mode=link --silent $$tag `head -n 1 conf-ld` '-o "$$lib" -rpath' `head -n 1 conf-lib` -version-info `head -n 1 LIBVERSION` '$${1+"$$@"}' `cat socket.lib`;\
 	) >makeshlib
 	chmod 755 makeshlib
 
@@ -710,7 +710,7 @@ net.lib: compile load
 	@echo 'main() { ; }' >trylib-lnet.c
 	@{ ./compile trylib-lnet.c && ./load trylib-lnet -lnet; } >/dev/null 2>&1 \
 	  && { echo -lnet >net.lib; echo yes; } \
-	  || { echo -n >net.lib; echo no; }
+	  || { : >net.lib; echo no; }
 	@rm -f trylib-lnet.c trylib-lnet.o trylib-lnet
 
 net/accept4.lo net/accept4.o: ltcompile net/accept4.c net/socket.h net/ipv4.h sysdeps.h net/ipv6.h sysdeps.h
@@ -876,9 +876,7 @@ path/mktemp.lo path/mktemp.o: ltcompile 
 	./ltcompile path/mktemp.c
 
 perl-head.pl: 
-	( set -e; PATH="/bin:/usr/bin:/usr/local/bin:$$PATH"; export PATH; \
-	  perl=`which perl`; \
-	  echo "#! $$perl"; \
+	( echo "#! ${PERL5}"; \
 	  echo "# WARNING: This file was auto-generated. Do not edit!"; \
 	  echo ) >perl-head.pl
 
@@ -896,7 +894,7 @@ rt.lib: compile load
 	@echo 'main() { ; }' >trylib-lrt.c
 	@{ ./compile trylib-lrt.c && ./load trylib-lrt -lrt; } >/dev/null 2>&1 \
 	  && { echo -lrt >rt.lib; echo yes; } \
-	  || { echo -n >rt.lib; echo no; }
+	  || { : >rt.lib; echo no; }
 	@rm -f trylib-lrt.c trylib-lrt.o trylib-lrt
 
 s.lib: compile load
@@ -904,7 +902,7 @@ s.lib: compile load
 	@echo 'main() { ; }' >trylib-ls.c
 	@{ ./compile trylib-ls.c && ./load trylib-ls -ls; } >/dev/null 2>&1 \
 	  && { echo -ls >s.lib; echo yes; } \
-	  || { echo -n >s.lib; echo no; }
+	  || { : >s.lib; echo no; }
 	@rm -f trylib-ls.c trylib-ls.o trylib-ls
 
 selftests: selftests.sh sysdeps.h libbg-sysdeps.la libbg.la
@@ -915,7 +913,7 @@ shadow.lib: compile load
 	@echo 'main() { ; }' >trylib-lshadow.c
 	@{ ./compile trylib-lshadow.c && ./load trylib-lshadow -lshadow; } >/dev/null 2>&1 \
 	  && { echo -lshadow >shadow.lib; echo yes; } \
-	  || { echo -n >shadow.lib; echo no; }
+	  || { : >shadow.lib; echo no; }
 	@rm -f trylib-lshadow.c trylib-lshadow.o trylib-lshadow
 
 socket.lib: compile load
